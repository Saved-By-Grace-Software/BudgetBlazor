@attribute [Authorize]
@page "/Budgets"
@inherits BudgetsBase

<PageTitle>Budgets</PageTitle>

<!-- Header Card -->
<MudCard Class="mt-2 mb-4 mud-theme-tertiary">
    <MudCardHeader>
        <CardHeaderContent>
            <MudStack Row="true" Spacing="4" AlignItems="AlignItems.Center">
                <MudIcon Icon="@Icons.Material.Filled.PieChartOutline" Size="Size.Large" />
                <MudText Typo="Typo.h4">Budgets</MudText>
            </MudStack>
            
        </CardHeaderContent>
        <CardHeaderActions>
            <MudGrid Spacing="0" Justify="Justify.Center">
                <MudItem xs="3" Style="text-align: right !important; padding: 1rem 0;">
                    <MudIconButton Icon="@Icons.Filled.ArrowLeft" OnClick="LastMonth" />
                </MudItem>
                <MudItem xs="6">
                    <MudDatePicker 
                        PickerVariant="PickerVariant.Dialog" 
                        DateFormat="MMMM yyyy" 
                        FixDay="1" 
                        OpenTo="OpenTo.Month" 
                        IconSize="Size.Large" 
                        PickerMonthChanged="MonthChanged"
                        @bind-Date="_currentMonth" />
                </MudItem>
                <MudItem xs="3" Style="text-align: left !important; padding: 1rem 0;">
                    <MudIconButton Icon="@Icons.Filled.ArrowRight" OnClick="NextMonth" />
                </MudItem>
            </MudGrid>
        </CardHeaderActions>
    </MudCardHeader>
</MudCard>

<!-- Income and Total Budget Card -->
<MudCard Class="my-4" Elevation="3">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h6">Total Budget - @String.Format("{0:MMMM yyyy}", _currentMonth)</MudText>
        </CardHeaderContent>
        <CardHeaderActions>
            <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Default" OnClick="OpenDialog" />
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent Class="my-n4">
        <MudPaper Class="my-2 pa-1" Elevation="1">
            <MudText Typo="Typo.subtitle2"><i>Expected Income - </i>$@String.Format("{0:0.00}", month.ExpectedIncome)</MudText>
            <MudProgressLinear Color="@ColorHelpers.ProgressBarColorReverse(month.PercentBudgeted)" Rounded="true" Size="Size.Large" Value="@month.PercentBudgeted" />
            <MudText Typo="Typo.subtitle2"><i>Total Budgeted - </i>$@String.Format("{0:0.00}", month.TotalBudgeted)</MudText>
        </MudPaper>
        
        <MudPaper Class="my-2 pa-1" Elevation="1">
            <MudText Typo="Typo.subtitle2"><i>Actual Income - </i>$@String.Format("{0:0.00}", month.ActualIncome)</MudText>
            <MudProgressLinear Color="@ColorHelpers.ProgressBarColor(month.PercentSpent)" Rounded="true" Size="Size.Large" Value="@month.PercentSpent" />
            <MudText Typo="Typo.subtitle2"><i>Total Spent - </i>$@String.Format("{0:0.00}", month.TotalSpent)</MudText>
        </MudPaper>
    </MudCardContent>
</MudCard>

<!-- Budget Lists -->
<MudCard Class="my-8" Elevation="3">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h6">Budgets</MudText>
        </CardHeaderContent>
        <CardHeaderActions>
            <MudMenu Icon="@Icons.Material.Filled.Add">
                <MudMenuItem>Add Budget</MudMenuItem>
                <MudMenuItem>Add Budget Group</MudMenuItem>
            </MudMenu>
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent>
        <MudStack>
            <BudgetItemDisplay Item="@month.BudgetItems[0]" />
            <BudgetItemDisplay Item="@month.BudgetItems[0]" />
            <BudgetItemDisplay Item="@month.BudgetItems[0]" />
            <BudgetItemDisplay Item="@month.BudgetItems[0]" />
        </MudStack>
    </MudCardContent>
</MudCard>